#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <ctype.h>
#include <stdbool.h>
#define DEBUG printf("---debugä½ç½®---\nè¡Œå·:%d\næ–‡ä»¶å:<%s>",__LINE__,__FILE__);getchar();

#include <../include/config.h>
#include <../include/Chess_Operate.h>

GYF_Debug_Mode *gyf_debug_mode = NULL;
ColorCode *color=NULL;
// 0çº¢ï¼Œ1é»‘
short current_player=0;
short ç¬¬å‡ å›åˆ=0;

/*
ã€Šè°ƒè¯•æ¨¡å¼è®¾ç½®ã€‹
GYF_Debug_Mode->DoesMsgPrintï¼šæ˜¯å¦è¿›è¡Œdebugä¿¡æ¯è¾“å‡ºã€‚
GYF_Debug_Mode->DoesTestï¼šæ˜¯å¦è¿›è¡Œç‰¹å®šæƒ…å†µæµ‹è¯•ã€‚ï¼ˆä¾‹å¦‚å¼ºåˆ¶å›ºå®šä¸€ä¸ªå€¼ï¼Œè§‚å¯Ÿå˜åŒ–ã€‚ï¼‰

å½“å‰æµ‹è¯•ï¼š
åªåœ¨141è¡Œé‚£ä¸€å¥è®©é€‰åˆ°çš„æ£‹å­åæ ‡å›ºå®šä¸º0
è€Œè½ç‚¹æ˜¯ç”±åæ ‡è®¡ç®—çš„
æ‰€ä»¥ä¸¾æ£‹ä»ç„¶æ˜¯æ­£å¸¸çš„ç´¢å¼•ï¼Œä½†è½ç‚¹æ˜¯ä¸æ­£å¸¸çš„
è¿™æ ·è½ç‚¹å¯ä»¥å›ºå®šåœ¨ç¬¬1è¡Œã€ç¬¬1åˆ—
è€Œå¼€å±€æˆ‘åªæ‘†6æšæ£‹å­
è€Œè¿™æ£‹ç›˜æš‚æ—¶è®¾ä¸º5åˆ—6è¡Œ
æ‰€ä»¥è¿™æ ·å®¹æ˜“å‘ç”Ÿåƒå­æ¥æµ‹è¯•
*/
void GYF_Debug_Mode_init(GYF_Debug_Mode *self)
{	
	self->DoesMsgPrint=false;
	
	self->DoesTest=false;
	
	// å›ºå®šè½æ£‹èŒƒå›´ï¼šç”¨åæ ‡æ§åˆ¶
	self->å›ºå®šè½æ£‹èŒƒå›´ = 0;
	
	// å›ºå®šé€‰æ£‹
	self->å›ºå®šé€‰æ£‹èŒƒå›´ = "Cc";
}



// å¯¹ç»“æ„ä½“TheStepè¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼šæŸ¥çœ‹å³å°†è½æ£‹çš„è¿™ä¸€æ­¥ç€æ³•æƒ…å†µ
void TheStep_show(TheStep *self)
{
	printf("from_x:%d\tfrom_y:%d\n"
	       "from_coord:(%d, %d)\n"
	"from:%d\tflip_to:%d\nmove_to:%d\n",
	
	self->from_x, self->from_y,
	self->from_coord[0], self->from_coord[1],
	self->from_index, self->to_index_of_flip, self->to_index_of_move);
}

// ç”¨äºæŸ¥çœ‹ä¾‹å¦‚å…¨åœºï¼ˆçº¢æ–¹/é»‘æ–¹ï¼‰æ£‹å­ç´¢å¼•æ•°ç»„
void show_æ•´æ•°æ•°ç»„(short *arr, short size, const char *prompt)
{
	printf(prompt);
	putchar('[');
	for (short i=0, *p=arr; i<size; i++, p++)
	{
		printf("%d",*p);
		i+1<size?putchar(','):false;
	}
	putchar(']');
}

// å¯¹ç»“æ„ä½“Gameè¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼šéšæ—¶æŸ¥çœ‹åœºä¸Šæ£‹å­çš„ç´¢å¼•æ•°ç»„æƒ…å†µ
void Game_show(Game *self)
{
	printf("ğŸ”\næŸ¥çœ‹Gameç»“æ„ä½“ä¿¡æ¯");
	
	show_æ•´æ•°æ•°ç»„(self->å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„, self->å…¨åœºæ£‹å­æ•°é‡, "å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„");
	putchar(10);
	
	printf("å…¨åœºæ£‹å­æ•°é‡ï¼š%d\n",self->å…¨åœºæ£‹å­æ•°é‡);
	
	show_æ•´æ•°æ•°ç»„(self->é»‘æ£‹ç´¢å¼•æ•°ç»„, self->é»‘æ£‹æ•°é‡, "é»‘æ£‹ç´¢å¼•æ•°ç»„"); putchar(10);
	printf("é»‘æ£‹æ•°é‡ï¼š%d\n",self->é»‘æ£‹æ•°é‡);
	
	show_æ•´æ•°æ•°ç»„(self->çº¢æ£‹ç´¢å¼•æ•°ç»„, self->çº¢æ£‹æ•°é‡, "çº¢æ£‹ç´¢å¼•æ•°ç»„"); putchar(10);
	printf("çº¢æ£‹æ•°é‡ï¼š%d\n",self->çº¢æ£‹æ•°é‡);
	
	show_æ•´æ•°æ•°ç»„(self->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„, self->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡, "å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„"); putchar(10);
	printf("å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡ï¼š%d\n",self->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡);
	
	show_æ•´æ•°æ•°ç»„(self->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„, self->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡, "å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„"); putchar(10);
	printf("å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡ï¼š%d\n",self->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡);getchar();
	
	
}


void äº¤æ¢ä¸¤ä¸ªæŒ‡é’ˆå€¼(void **ofsv, void **defsv)
{
	// å‡½æ•°å†…äº¤æ¢ä¸¤ä¸ªæŒ‡é’ˆå€¼
	// æ‰€ä»¥å¿…é¡»å¾—åˆ°è¯¥æŒ‡é’ˆçš„å¼•ç”¨ï¼ˆå­˜å‚¨è¯¥æŒ‡é’ˆçš„å†…å­˜ç©ºé—´ï¼‰
	// void æ¥æ”¶ä»»æ„ç±»å‹ï¼ˆä¼šè‡ªåŠ¨è½¬æ¢æˆéœ€è¦çš„ç±»å‹ï¼‰
	// void **ä¸void *[]ç­‰ä»·	
	
	/* å¦‚æœæ“ä½œæ–¹æ˜¯çº¢æ–¹ï¼Œåˆ™åˆ‡æ¢åˆ°é»‘æ–¹ã€‚
	å¦‚æœofsvæ˜¯redï¼Œdefsvæ˜¯blackï¼›
	åˆ™åˆ‡æ¢åˆ°ofsvæ˜¯blackï¼Œdefsvæ˜¯redã€‚
	*/
	void **temp = ofsv;
	*ofsv = *defsv;
	*defsv = *temp;
}


void Game_å†³å®šå½“å‰æ“ä½œæ–¹ä¸åº”å¯¹æ–¹ä¿¡æ¯(Game *game)
{
	/*
	è¿™é‡Œæ²¡æœ‰å¿…è¦è¿™æ ·å†³å®šçš„ã€‚
	æ²¡æœ‰å¿…è¦å¤§é‡åšèµ‹å€¼æ“ä½œã€‚
	è¿™ä¸€æ–¹å¸¦å¤§é‡ä¿¡æ¯ï¼Œé‚£ä¸€æ–¹å¸¦å¤§é‡ä¿¡æ¯ã€‚éš¾é“æ¯æ¬¡æœ‰å¤šå°‘å°±å¤šå°‘å…¨éƒ¨åˆ—å‡ºæ¥èµ‹å€¼è¦†ç›–è¿‡æ¥ï¼Ÿ
	åªè¦äº¤æ¢ä¸¤ä¸ªæŒ‡é’ˆå€¼å°±è¡Œäº†ã€‚
	
	ä¹Ÿæ²¡æœ‰å¿…è¦åˆ†æ¸…æ¥šæ˜¯çº¢æ–¹è¿˜æ˜¯é»‘æ–¹æ‰èµ‹å€¼ï¼Œä»è€Œèµ‹å€¼åŒæ ·éº»çƒ¦çš„ä¸¤éã€‚
	è€Œæ˜¯å¯ä»¥å…ˆç›²é€‰ã€‚
	å†çœ‹çŒœæ²¡çŒœå¯¹ã€‚
	çŒœå¯¹å°±ä¸ç”¨æ¢ï¼ŒçŒœé”™å°±æ¢ã€‚
	
	è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œè¢«åƒå­çš„å½“å‰åº”å¯¹æ–¹æ£‹å­æ•°é‡å·²ç»ç¡®å®è¢«ä¿®æ”¹äº†å®å‚ã€‚
	å½“ç„¶ï¼Œä¿®æ”¹å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡å¹¶ä¸å½±å“çº¢æ£‹æ•°é‡ã€é»‘æ£‹æ•°é‡ã€‚
	ä½†åœ¨é€‰æ£‹ä¹‹å‰ï¼Œåˆå…ˆè¿›è¡Œäº†å†³å®šåŒæ–¹ä¿¡æ¯å†é€‰æ£‹ã€‚
	è¿™æ—¶ä¸Šä¸€å›åˆåº”å¯¹æ–¹çš„æ£‹å­æ•°é‡åˆè¢«èµ‹å€¼è¦†ç›–ä¸ºæ°¸è¿œæ²¡å˜åŒ–çš„çº¢æ£‹æ•°é‡ã€é»‘æ£‹æ•°é‡ã€‚
	*/
	
	if (ç¬¬å‡ å›åˆ==1)
	{
		switch (current_player)
		{
			case 0:
			game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„ = game -> çº¢æ£‹ç´¢å¼•æ•°ç»„;
			game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡ = game -> çº¢æ£‹æ•°é‡;
			game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„ = game -> é»‘æ£‹ç´¢å¼•æ•°ç»„;
			game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡ = game -> é»‘æ£‹æ•°é‡;
			break;
			
			case 1:
			game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„ = game -> é»‘æ£‹ç´¢å¼•æ•°ç»„;
			game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡ = game -> é»‘æ£‹æ•°é‡;
			game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„ = game -> çº¢æ£‹ç´¢å¼•æ•°ç»„;
			game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡ = game -> çº¢æ£‹æ•°é‡;
			break;
			
			default:
			break;
		}
	}
	else
	{
		short temp_æ£‹å­æ•°é‡, *temp_æ£‹å­çš„ç´¢å¼•æ•°ç»„;
		
		if (gyf_debug_mode->DoesMsgPrint)
		{
		puts("âš¡ï¸å†³å®šåŒæ–¹ä¿¡æ¯æ—¶ï¼");
		printf("äº¤æ¢æ£‹å­æ•°é‡ä¸ç´¢å¼•æ•°ç»„ä¹‹å‰ï¼š%p, %p\n", game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„, game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„);		
		Game_show(game);
		}
		
		// äº¤æ¢å½“å‰xxæ–¹çš„æ£‹å­æ•°é‡
		temp_æ£‹å­æ•°é‡ = game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡;
		game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡ = game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡;
		game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡ = temp_æ£‹å­æ•°é‡;
		
		// äº¤æ¢å½“å‰xxæ–¹çš„ç´¢å¼•æ•°ç»„
		temp_æ£‹å­çš„ç´¢å¼•æ•°ç»„ = game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„;
		game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„ = game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„;
		game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„ = temp_æ£‹å­çš„ç´¢å¼•æ•°ç»„;		
		
		if (gyf_debug_mode->DoesMsgPrint)
		{		
		printf("äº¤æ¢æ£‹å­æ•°é‡ä¸ç´¢å¼•æ•°ç»„ä¹‹åï¼ˆéåŒæ­¥äº¤æ¢ï¼‰ï¼š%p, %p\n", game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„, game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„);
		Game_show(game);
		}	
	}
}

/*
void å›ºå®šé€‰æ£‹èŒƒå›´_è·å–å•æ–¹å¯é€‰æ£‹ç´¢å¼•æ•°ç»„(GYF_Debug_Mode *self, Game *game)
{
	short current_index;
	for (short i=0;i<game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡;i++)
	{
		current_index = game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„[i];
		if (strchr(self->å›ºå®šé€‰æ£‹èŒƒå›´, game->chessBoard[current_index]))
		{
			current_index
		};
}
*/

// - - - ä¸¾ æ£‹ - - -
// ä¸¾æ£‹ä¹‹é€‰æ£‹
void ä¸¾æ£‹_é€‰å–è¢«ç§»åŠ¨çš„æ£‹å­(Game *game, TheStep *ç€æ³•)
{
	if (!game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡)
	{
		printf("âŒæ— æ³•é€‰æ£‹ï¼šæ“ä½œæ–¹æ²¡æœ‰æ£‹å­äº†ã€‚");
		printf("æ¸¸æˆç»“æŸï¼");
		exit(EXIT_SUCCESS);
	}
	
	// ä»å½“å‰æ“ä½œæ–¹ï¼ˆå•æ–¹ï¼‰çš„æ£‹å­ç´¢å¼•çš„åˆ—è¡¨ä¸­éšæœºç´¢å¼•
	short éšæœºæ•° = rand() %  game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­æ•°é‡;
	
	// ä¹Ÿå¯é€‰æŒ‡å®šç´¢å¼•çš„æ£‹å­
	//éšæœºæ•° = 0;
	
	// è·å–é€‰åˆ°çš„æ£‹å­å¯¹äºæ£‹ç›˜çš„ç´¢å¼•
	ç€æ³•->from_index = game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„[éšæœºæ•°];
	
	// æ£€æŸ¥é€‰åˆ°çš„æ£‹å­å¯¹äºæ£‹ç›˜çš„ç´¢å¼•æ˜¯å¦æœ‰æ•ˆï¼šå‡ºç°è¶Šå‡ºæ£‹ç›˜æƒ…å†µ
	if (!æ˜¯å¦æœ‰æ•ˆç´¢å¼•(ç€æ³•->from_index))
	{
		puts("âš¡ï¸æ£€æŸ¥é€‰åˆ°çš„æ£‹å­å¯¹äºæ£‹ç›˜çš„ç´¢å¼•æ˜¯å¦æœ‰æ•ˆï¼šå‡ºç°è¶Šå‡ºæ£‹ç›˜æƒ…å†µ");
		printf("âŒ%sé€‰åˆ°çš„æ£‹å­ç´¢å¼•æ˜¯%d\n",game->å½“å‰æ“ä½œæ–¹åç§°, ç€æ³•->from_index);
		printf("âŒç´¢å¼•å¤§é”™ï¼å¿…é¡»æ£€æŸ¥åœºä¸Šæ£‹å­çš„æ“ä½œæ–¹ç´¢å¼•æ•°ç»„ï¼");
		puts("ğŸ”\næ­£åœ¨æ£€æŸ¥");
		Game_show(game);
		exit(EXIT_FAILURE);
	}

}

/*
æ›´æ–°ç€æ³•è½ç‚¹ã€‚
å·²æ”¯æŒå¯æ´»åŠ¨èŒƒå›´çš„ï¼š
è½¦ã€é©¬ã€ç‚®ã€‚
*/
void TheStep_update_toIndexOfMove(Game *game, TheStep *ç€æ³•)
{
	switch (tolower(game->chessBoard[ç€æ³•->from_index]))
	{
		case 'c':
		ç€æ³•->to_index_of_move = è½¦çš„å¯æ´»åŠ¨èŒƒå›´ç¼©å°åŠå‡†å¤‡ç§»åŠ¨åˆ°çš„éšæœºè½ç‚¹(game->chessBoard, ç€æ³•->from_coord);
		break;
		
		case 'm':
		ç€æ³•->to_index_of_move = é©¬çš„å¯æ´»åŠ¨èŒƒå›´ç¼©å°åŠå‡†å¤‡ç§»åŠ¨åˆ°çš„éšæœºè½ç‚¹(game->chessBoard, ç€æ³•->from_coord);
		break;
		
		case 'p':
		ç€æ³•->to_index_of_move = ç‚®çš„å¯æ´»åŠ¨èŒƒå›´ç¼©å°åŠå‡†å¤‡ç§»åŠ¨åˆ°çš„éšæœºè½ç‚¹(game->chessBoard, ç€æ³•->from_coord);
		break;		
		
		default:
		ç€æ³•->to_index_of_move = -1;
		break;
	}
}

// ä¸¾æ£‹ä¹‹é€‰æ£‹ä¸å¯è½ç‚¹è®¡ç®—
void ä¸¾æ£‹_å®Œå…¨éšæœº(Game *game, TheStep *ç€æ³•)
{
	start:
	// è·å–é€‰åˆ°çš„æ£‹å­å¯¹äºæ£‹ç›˜çš„ç´¢å¼•
	ä¸¾æ£‹_é€‰å–è¢«ç§»åŠ¨çš„æ£‹å­(game, ç€æ³•);
							
	// æ˜¾ç¤ºé€‰åˆ°çš„æ£‹å­ä¿¡æ¯				
	printf("é€‰åˆ°çš„piece:%c from_index:%d\n",
	game->chessBoard[ç€æ³•->from_index], ç€æ³•->from_index);
	getchar();
	
	// å°†é€‰åˆ°çš„æ£‹å­çš„ç´¢å¼•è½¬åæ ‡
	ç´¢å¼•è½¬åæ ‡(gyf_debug_mode->DoesTest?gyf_debug_mode->å›ºå®šè½æ£‹èŒƒå›´:ç€æ³•->from_index, ç€æ³•->from_coord);
	ç€æ³•->from_x=ç€æ³•->from_coord[0];
	ç€æ³•->from_y=ç€æ³•->from_coord[1];
	
	if (gyf_debug_mode->DoesMsgPrint) puts("âš¡ï¸ã€Šä¸¾æ£‹ä¹‹å¯è½ç‚¹ä¹‹æ£€æŸ¥ã€‹");
	// è®¡ç®—å¯è½ç‚¹ä»¥åŠå†³å®šè½ç‚¹
	TheStep_update_toIndexOfMove(game, ç€æ³•);	
	
	
	// é€‰åˆ°çš„æ£‹å­æ˜¯æ— æ³•ç§»åŠ¨çš„ï¼šéœ€è¦é‡æ–°é€‰æ‹©æ£‹å­
	if (ç€æ³•->to_index_of_move == -1)
	{
		printf("â—ï¸è¯¥æ£‹å­æ— å¯è½ç‚¹ï¼Œè¯·é‡æ–°é€‰æ‹©æ£‹å­ã€‚\n");
		goto start;
	}
	
	char *æ£‹å­å†…å®¹_ä¸­æ–‡=malloc(10);
	strcpy(æ£‹å­å†…å®¹_ä¸­æ–‡, current_player?"é»‘":"çº¢");
	switch (tolower(game->chessBoard[ç€æ³•->from_index]))
	{
		case 'c':
		strcat(æ£‹å­å†…å®¹_ä¸­æ–‡, "è½¦");
		break;
		
		case 'm':
		strcat(æ£‹å­å†…å®¹_ä¸­æ–‡, "é©¬");
		break;

		case 'p':
		strcat(æ£‹å­å†…å®¹_ä¸­æ–‡, "ç‚®");
		break;
		
		case 'b':
		strcat(æ£‹å­å†…å®¹_ä¸­æ–‡, !strcmp(æ£‹å­å†…å®¹_ä¸­æ–‡, "çº¢")?"å…µ":"å’");
		break;
		
		default:break;
	}
	
	
	printf("%sçš„æœ¬æ¬¡è½ç‚¹ç´¢å¼•ï¼š%d\n", æ£‹å­å†…å®¹_ä¸­æ–‡, ç€æ³•->to_index_of_move);
}

// è½æ£‹
/*
ä¸€æšæ£‹å­çš„ç´¢å¼•å˜åŒ–ï¼šå•æ–¹å¯èµ·æ£‹ç´¢å¼•å˜åŒ–
å…¨åœºä¸¤ä¸ªç‚¹çš„å†…å®¹å˜åŒ–
å…¨åœºæ£‹å­æ•°é‡å˜åŒ–
å•æ–¹æ£‹å­æ•°é‡å˜åŒ–
*/
void è½æ£‹(Game *game, TheStep *ç€æ³•)
{
	short ofsv_from = ç€æ³•->from_index;
	short ofsv_move_to = ç€æ³•->to_index_of_move;
	char nullpos='o';
	
	puts("âš¡ï¸è½æ£‹ä¹‹å‰çœ‹ä¸€ä¸‹ç´¢å¼•ä¿¡æ¯ï¼");
	Game_show(game);

	/*
	from_indexå†…å®¹å¿…å®šå˜ç©ºã€‚
	move_to_indexå†…å®¹å¿…å®šå˜ç§»åŠ¨çš„æ£‹ã€‚
	
	move_to_indexå¯èƒ½é‡ç©ºï¼Œå¯èƒ½é‡æ•Œã€‚
	é‡ç©ºï¼ŒåŸºç¡€å˜åŒ–ã€‚
	é‡æ•Œï¼Œé™¤äº†åŸºç¡€å˜åŒ–ä»¥å¤–ï¼Œæ•Œæ–¹å¯é€‰æ£‹å­å¿…é¡»å‡å°‘ä¸€ä¸ªã€‚
	è¿™æ—¶ï¼Œå…¨åœºæ£‹å­ç´¢å¼•å¿…å®šå‡ºç°é‡å¤çš„ï¼Œè¦å»é‡ï¼Œæ‰€ä»¥ä¹Ÿè¦å‡å°‘ä¸€ä¸ªã€‚
	å› ä¸ºåœ¨å…¨åœºæ£‹å­ç´¢å¼•ä¸­ï¼ŒåŒæ ·çš„ç´¢å¼•ï¼Œæ–°æ£‹åˆšåˆšå é¢†ï¼Œæ—§æ£‹å·²ç»æ­»äº¡ï¼Œä¸èƒ½æœ‰åŒæ–¹æ£‹åŒæ—¶å ä¸€ä¸ªç´¢å¼•ã€‚
	
	æ£‹ç›˜å†…å®¹ä¸éœ€è¦å˜åŒ–ï¼Œå› ä¸ºæ—§æ£‹å†…å®¹å·²ç»è¢«æ–°æ£‹å†…å®¹è¦†ç›–ã€‚	
	*/	
	
	// ç§»åŠ¨åå¿…ç„¶çš„æ¶ˆå¤±å¹¶æ›¿æ¢
	replace_num(game->å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„, ofsv_from, ofsv_move_to);
	replace_num(game->å½“å‰æ“ä½œæ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„, ofsv_from, ofsv_move_to);
	
	// ç§»åŠ¨åè½ç‚¹ä¸ºåƒæ•Œå­çš„æ•Œæ¶ˆå¤±+æ¶ˆå¤±å¹¶æ›¿æ¢ï¼ˆåŸºç¡€ï¼‰
	puts("âš¡ï¸ã€Šè½æ£‹ä¹‹æ£€æŸ¥ã€‹");
	puts("âš¡ï¸æ£€æŸ¥è½ç‚¹å†…å®¹æ˜¯å¦ä¸ºæ•Œæ£‹ï¼šè¿™ä¸€æ­¥æ˜¯å¦ä¼šåƒäº†æ•Œæ£‹");
	short æ£‹ä½å†…å®¹æ˜¯å“ªç§æƒ…å†µ = åˆ¤æ–­è¯¥æ£‹ä½å†…å®¹æƒ…å†µ(game->chessBoard[ofsv_move_to]);
	if ( æ£‹ä½å†…å®¹æ˜¯å“ªç§æƒ…å†µ == true )
	{
		printf("æ“ä½œæ–¹ç§»åŠ¨åˆ°çš„æ£‹ä½ä¹‹å†…å®¹:%c\n",game->chessBoard[ofsv_move_to]);
		printf("å½“å‰ç©å®¶(0çº¢1é»‘):%d\n",current_player);
		printf("åˆ¤æ–­è¯¥æ£‹ä½æƒ…å†µ(-1ç©º1æ•Œ0å·±):%d\n", æ£‹ä½å†…å®¹æ˜¯å“ªç§æƒ…å†µ);
		
		// æˆ‘çŸ¥é“æ­¤å¤„ä¸ºä»€ä¹ˆæ— æ³•åˆ é™¤å•æ–¹ç´¢å¼•æ•°é‡äº†ã€‚
		// å› ä¸ºè™½ç„¶å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡æ”¹å˜äº†ï¼Œä½†è¿™æ”¹å˜ä¹‹å‰çš„å€¼å´æ˜¯é€šè¿‡èµ‹å€¼å¾—åˆ°çš„ã€‚
		// æƒ³è¦æ”¹å˜çº¢æ£‹æ•°é‡ã€‚è€Œæœ€åˆå´æ˜¯ï¼šå½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡ = çº¢æ£‹æ•°é‡ã€‚
		// é‚£ä¹ˆï¼Œå½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡--ï¼Œæ€ä¹ˆå½±å“çº¢æ£‹æ•°é‡å‘¢ï¼Ÿ
		// é™¤éèƒ½å¤Ÿå¾—åˆ°çº¢æ£‹æ•°é‡çš„åœ°å€ã€‚
		// å°±åƒb=3ï¼Œa=bã€‚è¿™æ—¶aå­˜æ”¾3ã€‚a=2ï¼Œä¿®æ”¹äº†aï¼Œaå­˜æ”¾2ã€‚ä½†bä»ç„¶å­˜æ”¾3ã€‚
		// æ‰€ä»¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç»“æ„ä½“é‡è¦ã€æŒ‡é’ˆé‡è¦ã€‚æ¯”å¤§é‡èµ‹å€¼è¦†ç›–å¥½å¤ªå¤šäº†ã€‚
		puts("âš¡ï¸ã€Šæ£€æŸ¥å¯¹å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡è¿›è¡Œå‡å°‘æ˜¯å¦æˆåŠŸã€‹");
		printf("åŸæ•°é‡ï¼š%d\n", game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡);
		remove_num(game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­çš„ç´¢å¼•æ•°ç»„, ofsv_move_to, &game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡);
		printf("è¿›è¡Œåˆ é™¤æ“ä½œåæ•°é‡ï¼š%d\n", game->å½“å‰åº”å¯¹æ–¹çš„æ£‹å­æ•°é‡);
		remove_num(game->å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„, ofsv_move_to, &game->å…¨åœºæ£‹å­æ•°é‡);
	}
	
	// å®Œæˆè½ç‚¹
	game->chessBoard[ofsv_move_to] = game->chessBoard[ofsv_from];
	game->chessBoard[ofsv_from] = nullpos;
		
}

void å¤åˆ¶æ£‹ç›˜(char *defsv, char *ofsv)
{
	strcpy(defsv, ofsv);
}

void åˆ‡æ¢æ“ä½œæ–¹()
{
	current_player++;
	if (current_player>1)current_player=0;

}


void main()
{
	srand(time(NULL));
	
	color = (ColorCode*) malloc (sizeof (ColorCode));
	ColorCode_init(color);
	
	gyf_debug_mode = (GYF_Debug_Mode *)malloc (sizeof (GYF_Debug_Mode));
	GYF_Debug_Mode_init(gyf_debug_mode);
	
	current_player = 0;
		
	// å…±ç”¨ä¸€ä¸ªæ£‹ç›˜è§†å›¾ã€‚ï¼ˆç»Ÿä¸€åæ ‡ç³»ã€‚å› ä¸ºå€’è½¬æ— æ„ä¹‰ï¼‰
	// æš‚æ—¶ç”¨å­—ç¬¦æ•°ç»„å‚¨å­˜ä¿¡æ¯ã€‚ä»¥åæ‰©å±•è‡³ç»“æ„ä½“æ•°ç»„ã€‚
	/* Gameç»“æ„ä½“ï¼šåŒ…å«ä¿¡æ¯æœ‰
	å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„ï¼šç”¨äºå¯¹å¼ˆä¸¤ä¸ªç‚¹ä¹‹å˜åŒ–
	å•æ–¹æ£‹å­ç´¢å¼•æ•°ç»„ï¼šç”¨äºé€‰æ£‹èŒƒå›´ç¼©å°ä¹‹å˜åŒ–
	*/
	Game *game = (Game *)malloc( sizeof (Game) );
	game->chessBoard = (char *)malloc (WIDTH * HEIGHT +1);
	
	// æ¯æ¬¡å­˜æ¡£ä¸€æšæ­£åœ¨ä¸¾æ£‹æˆ–è½æ£‹çš„æ£‹å­çš„ä¿¡æ¯
	TheStep *ç€æ³• = (TheStep *) malloc ( sizeof (TheStep));
	

	// å¼€å±€æ£‹å­ä¿¡æ¯ï¼šåæ ‡ä¸å†…å®¹
	/* æ—¢ç„¶å¯¹åº”ï¼Œä¸å¦‚ï¼š
	å¼€å±€å¤šä¸ªæ£‹å­éœ€è¦ä»€ä¹ˆï¼š
	æŒ‡å®šåæ ‡ï¼ˆæˆå‘˜å±æ€§ï¼‰
	å¯¹åº”å†…å®¹ï¼ˆæˆå‘˜å±æ€§ï¼‰
	å­˜å‚¨å¤šä¸ªæ£‹å­çš„å®¹å™¨
	*/
	/*
	shortæ˜¯2ä¸ªå­—èŠ‚ã€‚
	äºŒç»´æ•°ç»„ç­‰äºä¸¤ä¸ªç»´åº¦ç›¸ä¹˜çš„ä¸€ç»´æ•°ç»„ã€‚
	æ¯ä¸ªä½ç»´è£…è¿ç»­çš„æ¨ªçºµåæ ‡ï¼Œéœ€è¦2ä¸ªã€‚
	éœ€è¦6ä¸ªåæ ‡ï¼Œæ‰€ä»¥é«˜ç»´6ä¸ªã€‚
	6*2=12ã€‚
	æ‰€ä»¥[6][2]äºŒç»´æ•°ç»„æ˜¯[12]ä¸€ç»´æ•°ç»„ã€‚
	shortå°±6*2*2=24å­—èŠ‚ã€‚
	intå°±6*2*4=48å­—èŠ‚ã€‚
	
	short *[2]ä¸åŒäºshort[][]
	åè€…æ˜¯å­˜æ”¾shortã€‚
	å‰è€…æ˜¯å­˜æ”¾æŒ‡é’ˆã€‚
	ä¸€ä¸ªæŒ‡é’ˆæ˜¯8å­—èŠ‚ã€‚
	å‰è€…æ˜¯2ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æ˜¯16ä¸ªå­—èŠ‚ã€‚
	*/
	short å¼€å±€å¤šä¸ªæ£‹å­çš„åæ ‡äºŒç»´æ•°ç»„[][2] =
	{
		/*
		è§„å¾‹ï¼š
		é»‘12 çº¢34
		ä»ä¸­å¿ƒå¾€ä¸¤è¾¹ç­‰è·æ‹‰å¼€
		ç¦»åŸç‚¹æœ€è¿‘ï¼š2ä¸3
		æ‹‰è¿œï¼š1ä¸4
		å¯¹è§’çº¿å¯¹ç§°åæ ‡ç›¸åŠ ï¼š
		æ¨ªåæ ‡ç›¸åŠ å¿…ç­‰äºæœ€æœ«æ¨ªåæ ‡ã€‚
		çºµåæ ‡ç›¸åŠ å¿…ç­‰äºæœ€æœ«çºµåæ ‡ã€‚
		
		*/
		// é»‘åŒè½¦/çº¢åŒè½¦
		{0, 0}, {8, 0}, {0, 9}, {8, 9},
		// é»‘åŒé©¬/çº¢åŒé©¬
		{1, 0}, {7, 0}, {1, 9}, {7, 9},
		// é»‘åŒç‚®/çº¢åŒç‚®
		{1, 2}, {7, 2}, {1, 7}, {7, 7},

	};
	short åæ ‡æ•°é‡ = sizeof (å¼€å±€å¤šä¸ªæ£‹å­çš„åæ ‡äºŒç»´æ•°ç»„) / sizeof (short ) /2;
	const char *å¼€å±€å¤šä¸ªæ£‹å­çš„å¯¹åº”å†…å®¹æ•°ç»„ = "CCccMMmmPPpp";

	
	// å¯¹å®¹å™¨å†…ä»»æ„æ•°é‡çš„å…ƒç´ è¿›è¡Œå¾ªç¯è½®æµï¼ˆä»¥å¯¹ç´¢å¼•è¿›è¡Œå¾ªç¯è½®æµæ¥å®ç°ï¼‰
	/*
	char *loop[2];
	loop[0] = malloc(5);
	loop[1] = malloc(5);
	
	strcpy(loop[0],"black");
	strcpy(loop[1],"red");
	*/


	// æ£‹ç›˜æ— æ£‹
	å…ˆå¡«æ»¡é»˜è®¤ç©º(game->chessBoard);
	// show_æ£‹ç›˜(chessBoard); getchar();
	
	// æ£‹ç›˜æ‘†æ£‹
	æ‘†æ£‹(game->chessBoard, å¼€å±€å¤šä¸ªæ£‹å­çš„åæ ‡äºŒç»´æ•°ç»„, åæ ‡æ•°é‡, å¼€å±€å¤šä¸ªæ£‹å­çš„å¯¹åº”å†…å®¹æ•°ç»„);
	// show_æ£‹ç›˜(chessBoard); getchar();
	
	
	/*
	å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„ï¼šå…¨åœºå¯¹å¼ˆï¼Œä¸¤ç‚¹å˜åŒ–
	æ— æ£‹å­ä¸è£…
	åªæœ‰æœ‰æ£‹å­å°±è£…è¿›æ¥
	ç­‰åŒäºè€ç‰ˆæœ¬çš„â€œåœºä¸Šæ£‹å­çš„æ“ä½œæ–¹ç´¢å¼•æ•°ç»„â€
	*/
	
	// å¼€å±€åœºä¸Šæ£‹å­ä¿¡æ¯ï¼šç´¢å¼•ã€æ•°é‡
	// ï¼ˆä»¥æ­¤ä¸ºåŸºç¡€æ— é™å˜åŒ–ï¼Œæ¯æ¬¡å˜åŒ–æå°é‡ï¼šåç»­åªéœ€è¦è¿›è¡Œæœ€å°‘ä¸”æœ€å¤šä¸¤ä¸ªç‚¹å˜åŒ–å¼•èµ·çš„å˜åŒ–ï¼‰
	
	game->å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„ = (short*) malloc ( sizeof ( short ) * åæ ‡æ•°é‡);	
	game->é»‘æ£‹ç´¢å¼•æ•°ç»„ = (short*) malloc ( sizeof ( short ) * åæ ‡æ•°é‡);
	game->çº¢æ£‹ç´¢å¼•æ•°ç»„ = (short*) malloc ( sizeof ( short ) * åæ ‡æ•°é‡);
	
	Game_æ›´æ–°å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„( game );
	Game_show( game );	
	
	
	/*
	// å°†å½“å‰åº”å¯¹æ–¹çš„æ£‹ç›˜å€’è½¬
	å€’è½¬(defensive, å…¨åœºæ£‹å­æ•°é‡, å…¨åœºæ£‹å­çš„ç´¢å¼•æ•°ç»„,
		   å…¨åœºæ£‹å­çš„å€’è½¬åç´¢å¼•æ•°ç»„);
	*/
		   
	// å¼€å±€æ˜¾ç¤ºä¸€ä¸ªå…±ç”¨æ£‹ç›˜
	show_æ£‹ç›˜(game->chessBoard); getchar();
	
	
	start:
	// - - - æ£‹å·²æ‘†å¥½ï¼Œå¼€å§‹å¯¹å±€ - - -
	ç¬¬å‡ å›åˆ++;
	printf("ç¬¬%då›åˆï¼Œæ“ä½œæ–¹ä¸ºï¼š", ç¬¬å‡ å›åˆ);
	if (current_player)
	{
		game->å½“å‰æ“ä½œæ–¹åç§° = "é»‘æ–¹";
		printf("%s%s",color->black,"é»‘æ–¹");
	}
	else
	{
		game->å½“å‰æ“ä½œæ–¹åç§° = "çº¢æ–¹";
		printf("%s%s",color->red,"çº¢æ–¹");
	}
	puts(color->reset); putchar(10);
	
	// ç¼©å°å¯é€‰æ£‹å­ï¼šåœºä¸Šæ£‹å­æ•°é‡ -> å•æ–¹æ£‹å­æ•°é‡
	Game_å†³å®šå½“å‰æ“ä½œæ–¹ä¸åº”å¯¹æ–¹ä¿¡æ¯(game);
	puts("âš¡ï¸å†³å®šåŒæ–¹ä¿¡æ¯ä¹‹åï¼Œé€‰æ£‹ä¹‹å‰çœ‹ä¸€ä¸‹æ£‹å­ä¿¡æ¯ï¼");
	Game_show(game);
	
	// ä¸¾æ£‹ï¼šé€‰æ£‹ä¸å¯è½ç‚¹è®¡ç®—
	ä¸¾æ£‹_å®Œå…¨éšæœº(game, ç€æ³•);
	
	// æ˜¾ç¤ºè¿™ä¸€æ­¥æ£‹çš„è®¡åˆ’ç€æ³•							 
	TheStep_show(ç€æ³•);
	putchar(10);
	
	// è½æ£‹
	/*
	ä¸€æšæ£‹å­çš„ç´¢å¼•å˜åŒ–ï¼šå•æ–¹å¯èµ·æ£‹ç´¢å¼•å˜åŒ–
	å…¨åœºä¸¤ä¸ªç‚¹çš„å†…å®¹å˜åŒ–
	å…¨åœºæ£‹å­æ•°é‡å˜åŒ–
	å•æ–¹æ£‹å­æ•°é‡å˜åŒ–
	*/
	è½æ£‹(game, ç€æ³•);
	
	// æ˜¾ç¤ºå•å‘è§†å›¾æ£‹ç›˜
	show_æ£‹ç›˜(game->chessBoard); getchar();
	
	// åˆ‡æ¢æ“ä½œæ–¹
	åˆ‡æ¢æ“ä½œæ–¹();
	goto start;
}